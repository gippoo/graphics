<!DOCTYPE html>
<html>

<head>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.1/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.1/addons/p5.dom.min.js"> </script>
</head>


<body>
  <script>
    var sheet;
    var furries = [];
    var spriteSheet = [];
    var raceStart = false;
    var raceOver = false;
    var raceButton;
    var catIDs = ['Top Cat', 'Mid Cat', 'Bot Cat'];
    var winner;

    function preload() {
      sheet = loadImage('https://gippoo.github.io/graphics/cat.png')
      backG = loadImage('https://gippoo.github.io/graphics/cat/catbg.png');
    }

    function cat(yCoord, id) {
      this.x = 608;
      this.y = yCoord;
      this.speed = random(10,20);
      this.id = id;

      this.move = function() {
        if (raceStart) {
          if (this.x > -16) {
            this.x-=this.speed;
          }
        }
      }

      this.show = function() {
        if (raceStart == true) {
          image(spriteSheet[frameCount%2],this.x, this.y)
        } else {
          image(spriteSheet[0],this.x, this.y)
        }
      }
    }

    function setup() {
      let can = createCanvas(640, 480);
      can.style("border:1px solid #000000;");
      frameRate(5);
      raceButton = createButton('Start Race');
      raceButton.mousePressed(startRace);
      raceButton.position(20,height+20);
      textSize(32);

      for (let i = 0; i < 2; i++) {
        let img = sheet.get(32*i,0,32,32);
        spriteSheet.push(img);
      }

      for (let i = 0; i < 3; i++) {
        furries[i] = new cat(i*160+60,catIDs[i]);
      }

    }

    function draw() {
      image(backG);
      for (let furry of furries) {
        furry.show();
        furry.move();
        checkWinner(furry);
        showWinner();
      }
    }

    function startRace() {
      if (!raceOver) {
       raceStart = true;
       raceButton.hide();
      }
    }

    function checkWinner(afurry) {
      if (afurry.x < 0 & raceStart == true) {
        raceStart = false;
        raceOver = true;
        setTimeout(reset,5000);
        winner = afurry.id;
      }
    }

    function showWinner() {
      if (raceOver) {
        s = 'Winner: ' + winner;
        text(s,200,50);
      }
    }

    function reset() {
      furries = [];
      for (let i = 0; i < 3; i++) {
        furries[i] = new cat(i*160+60,catIDs[i]);
      }
      raceOver = false;
      raceButton.show();
    }
  </script>
</body>
</html> 
